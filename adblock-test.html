<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Adblock / Tracker Ping Tester</title>
  <style>
    body {
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, Arial;
      padding: 20px;
      max-width: 900px;
      margin: auto;
      background: #000;
      color: #eee;
    }
    h1 { font-size: 1.4rem; margin-bottom: 0.2rem; color: #0f0; }
    p.small { margin-top: 0; color: #888; }
    .controls { margin: 12px 0; }
    button {
      padding: 8px 12px;
      margin: 4px 8px 4px 0;
      border-radius: 10px;
      border: 1px solid #222;
      background:#111;
      color: #eee;
      cursor:pointer;
      box-shadow: 0 0 6px rgba(0,255,0,0.4);
    }
    button:hover { background:#222; }
    button:disabled { opacity: 0.4; cursor: not-allowed; }
    label { display:inline-block; margin-right:12px; }
    input[type="checkbox"], select { margin-right:6px; }
    select {
      background: #111; color: #0f0; border: 1px solid #333;
      border-radius: 6px; padding: 4px;
    }
    textarea {
      width:100%; height:180px; background:#050505; color:#0f0;
      font-family: monospace; font-size: 12px; border:1px solid #222;
      border-radius: 8px; padding:8px;
    }
    #log {
      margin-top:12px; height:240px; overflow:auto;
      border:1px solid #222; padding:8px;
      background:#050505; font-family: monospace; font-size: 12px;
      border-radius: 8px;
    }
    .ok { color: #0f0; }
    .err { color: #f33; }
    .info { color: #0ff; }
  </style>
</head>
<body>
  <h1>Adblock / Tracker Ping Tester</h1>
  <p class="small">AMOLED-mode. Pings trackers at your chosen interval. Edit the list below freely. Results log is color-coded.</p>

  <div class="controls">
    <button id="startBtn">Start</button>
    <button id="stopBtn" disabled>Stop</button>
    <button id="clearLog">Clear Log</button>
    <label><input id="useImageFallback" type="checkbox" checked />Image fallback</label>
    <label><input id="verbose" type="checkbox" />Verbose</label>
    <label>
      Interval:
      <select id="intervalSel">
        <option value="1000">1s</option>
        <option value="5000">5s</option>
        <option value="10000">10s</option>
        <option value="30000">30s</option>
      </select>
    </label>
  </div>

  <div>
    <strong>Editable Tracker List</strong>
    <p class="small">Each URL must be on its own line. Saved automatically to localStorage.</p>
    <textarea id="trackers"></textarea>
  </div>

  <div id="log"></div>

  <script>
    const logEl = document.getElementById('log');
    function log(msg, cls="info") {
      const time = new Date().toLocaleTimeString();
      const div = document.createElement('div');
      div.className = cls;
      div.textContent = `[${time}] ${msg}`;
      logEl.appendChild(div);
      logEl.scrollTop = logEl.scrollHeight;
    }

    // Tracker list handling
    const textarea = document.getElementById('trackers');
    const LS_KEY = "adblockTestTrackers";

    const defaultTrackers = [
      "https://www.google-analytics.com/collect?v=1&tid=UA-000000-2&cid=test&t=pageview",
      "https://www.googletagservices.com/tag/js/gpt.js",
      "https://www.googleadservices.com/pagead/conversion/",
      "https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js",
      "https://stats.g.doubleclick.net/dc.js",
      "https://cm.g.doubleclick.net/pixel",
      "https://px.ads.linkedin.com/collect",
      "https://connect.facebook.net/en_US/fbevents.js",
      "https://www.facebook.com/tr/",
      "https://bat.bing.com/action/0?ti=000000",
      "https://ads.twitter.com/collect",
      "https://ads.yahoo.com/imp",
      "https://analytics.twitter.com/i/adsct",
      "https://ads.pinterest.com/ct/",
      "https://script.hotjar.com/modules-*.js",
      "https://cdn.heapanalytics.com/js/heap-xxxxxx.js",
      "https://bam.nr-data.net/1/[appID]?t=[timestamp]",
      "https://www.googletagmanager.com/gtm.js?id=GTM-XXXXXX"
    ];

    function loadTrackers() {
      const saved = localStorage.getItem(LS_KEY);
      textarea.value = saved ? saved : defaultTrackers.join("\n");
    }
    function getTrackers() {
      return textarea.value.split("\n").map(l => l.trim()).filter(Boolean);
    }
    textarea.addEventListener('input', () => {
      localStorage.setItem(LS_KEY, textarea.value);
    });
    loadTrackers();

    // Ping logic
    let intervalId = null;
    async function pingUrl(url) {
      try {
        await fetch(url, { method: 'GET', mode: 'no-cors', cache: 'no-store', keepalive: true });
        if (document.getElementById('verbose').checked) log(`fetch OK: ${url}`, "ok");
        return true;
      } catch (e) {
        if (document.getElementById('verbose').checked) log(`fetch FAIL: ${url}`, "err");
        return false;
      }
    }
    function imagePing(url) {
      return new Promise((resolve) => {
        const img = new Image();
        img.onload = () => resolve(true);
        img.onerror = () => resolve(false);
        img.src = url + (url.includes("?") ? "&" : "?") + "cb=" + Date.now();
        setTimeout(() => resolve(false), 3000);
      });
    }
    async function tick() {
      const list = getTrackers();
      await Promise.all(list.map(async u => {
        const ok = await pingUrl(u);
        if (!ok && document.getElementById('useImageFallback').checked) {
          const fb = await imagePing(u);
          if (fb) log(`image OK: ${u}`, "ok");
          else log(`blocked: ${u}`, "err");
        }
      }));
      if (!document.getElementById('verbose').checked) {
        log(`Pinged ${list.length} trackers`, "info");
      }
    }

    // Controls
    const startBtn = document.getElementById('startBtn');
    const stopBtn = document.getElementById('stopBtn');
    const clearBtn = document.getElementById('clearLog');
    const intervalSel = document.getElementById('intervalSel');

    startBtn.onclick = () => {
      if (intervalId) return;
      log("Starting ping loopâ€¦", "info");
      tick();
      intervalId = setInterval(tick, parseInt(intervalSel.value));
      startBtn.disabled = true;
      stopBtn.disabled = false;
    };
    stopBtn.onclick = () => {
      clearInterval(intervalId);
      intervalId = null;
      log("Stopped ping loop.", "info");
      startBtn.disabled = false;
      stopBtn.disabled = true;
    };
    clearBtn.onclick = () => { logEl.innerHTML = ""; };

    document.addEventListener("visibilitychange", () => {
      if (document.hidden && intervalId) {
        clearInterval(intervalId);
        intervalId = null;
        log("Paused due to tab hidden.", "info");
        startBtn.disabled = false;
        stopBtn.disabled = true;
      }
    });
  </script>
</body>
</html>
